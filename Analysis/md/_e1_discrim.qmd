---
title: "E1 Discrimination Analysis"
subtitle: "Fitting mixed effects models"
date: last-modified
categories: [Analysis, R]
code-fold: true
toc: false 
execute: 
  enabled: false
  eval: false
---

```{r setup}
pacman::p_load(tidyverse,tidybayes,brms,broom,broom.mixed,lme4,emmeans,here,knitr,kableExtra,gt,gghalves,patchwork,ggforce,ggdist,equatiomatic)
e1 <- readRDS(here("data/e1_08-04-23.rds"))
source(here("Functions/Display_Functions.R"))


test <- e1 |> filter(expMode2 == "Test") 
testAvg <- test %>% group_by(id, condit, vb, bandInt,bandType,tOrder) %>%
  summarise(nHits=sum(dist==0),vxMean=mean(vx),vxMed=median(vx),dist=mean(dist),sdist=mean(sdist),n=n(),Percent_Hit=nHits/n)

#test %>% filter(id==1, band==1) %>% select(vx) %>% unlist() %>% as.vector()
Sys.setenv(LIBGS = "/usr/local/share/ghostscript/10.00/lib/libgs.dylib.10.00")
font_opts <- list(dvisvgm.opts = "--font-format=woff")

library("tinytex")
font_opts <- list(extra.preamble = c("\\usepackage{libertine}", #"\\usepackage{libertinust1math}",
                                     "\\usepackage{xstring}",
                                     "\\usepackage{neuralnetwork}"),
                  dvisvgm.opts = "--font-format=woff")

font_opts2 <- list(extra.preamble = c("\\usepackage{amsmath}", #"alignment
                                     "\\usepackage{listofitems}", # create arrays
                                     "\\usepackage{xcolor}", 
                                     "\\usepackage[outline]{contour}"),  # glow around text
                  dvisvgm.opts = "--font-format=woff")

```

```{r}
#| eval: false
#| 
lmerFit <- function(mform,df) {
m=lmer(mform, df)
  fe <- fixef(m)
  dfm <- coef(m)$id %>% as.tibble(rownames="id") %>%rename("Intercept"=`(Intercept)`)
  for (effect in names(fe)) {
      dfm <- dfm %>% mutate(!!str_c("group_", effect) := fe[effect])
  }
  dfm
}

# Input formulas and corresponding dataframes
formulas <- c("vx ~ 1 + bandInt + (1 + bandInt | id)", 
              "vxMean ~ 1 + bandInt + (1 + bandInt | id)", 
              "vxMed ~ 1 + bandInt + (1 + bandInt | id)")
dfs <- list(test, testAvg, testAvg)

# Run lmerFit function over all combinations of formulas and dataframes
m_all <- map2_dfr(formulas, dfs, ~ lmerFit(.x, .y)) %>%
  mutate(mformula = rep(formulas, each = length(unique(test$id))), 
         dframe = rep(c('test', 'testAvg', 'testAvg'), each=length(unique(test$id))))

head(m_all)
m_all |> filter(id==1)

# m1 <- lmerFit("vx ~ 1 + bandInt + (1 + bandInt | id)",test)
# m2 <- lmerFit("vxMean ~ 1 + bandInt + (1 + bandInt | id)",testAvg)
# m3 <- lmerFit("vxMed ~ 1 + bandInt + (1 + bandInt | id)",testAvg)


m1 <- lmer(vx ~ 1 + bandInt + condit + (1 + bandInt | id),data=test)
coef(m1)$id %>% as.tibble(rownames="id") %>%rename("Intercept"=`(Intercept)`)
summary(m1)


fitted(m1)
new_data <- testAvg  |> ungroup() |> select(id,condit,bandInt) 
  
new_data=expand_grid(unique(test[, c("id", "condit")]), bandInt=unique(test$bandInt))
new_data <- new_data[rep(row.names(new_data), each = 10), ]

# Compute predictions
new_data$p <- predict(m1, newdata = new_data)


options(mc.cores = 4, brms.backend = "cmdstanr")

m1_bayes <- brm(vx ~ 1 + bandInt + condit + (1 + bandInt | id), data = test, family = gaussian())
summary(m1_bayes)

new_data=map_dfr(1, ~data.frame(unique(test[,c("id","condit","bandInt")]))) |> dplyr::arrange(id,bandInt)
predictions <- t(posterior_predict(m1_bayes, newdata = new_data,ndraws=10))
new_data$prediction <- rowMeans(predictions)


predicted_draws <- new_data %>%
  tidybayes::add_predicted_draws(m1_bayes,ndraws=5)


test$censored_vx <- ifelse(test$vx < 50, 50, test$vx)
test$censored_vx <- ifelse(test$censored_vx > 1600, 1600, test$censored_vx)
test$censored <- ifelse((test$vx <50 | test$vx>1600), TRUE, FALSE)

# fit model
m1_bayes <- brm(vx~ 1 + bandInt + condit + (1 + bandInt | id), 
                data = test, family = gaussian())



m1_bayesSN <- brm(vx ~ 1 + bandInt + condit + (1 + bandInt | id), data = test, family = skew_normal(),chains = 4)
summary(m1_bayesSN)


pst <- posterior_samples(m1_bayes, "b")
ggplot(testAvg, aes(x = bandInt, y = vxMean)) +
    geom_point(shape = 1) +
    geom_abline(
        data = pst, alpha = .01, size = .1,
        aes(intercept = b_Intercept, slope = b_bandInt)
    )

X <- cbind(test[,c("id","condit","trial","vb","bandInt","vx")], fitted(m1_bayes)[,-2]) %>% as_tibble()


```



```{r}
m1 <- lmer(vx ~ (1 + condit*bandInt) + (1 + bandInt | id),data=test)
extract_eq(m1)

```


$$
\begin{aligned}
  \operatorname{vx}_{i}  &\sim N \left(\alpha_{j[i]} + \beta_{1j[i]}(\operatorname{bandInt}), \sigma^2 \right) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &\alpha_{j} \\
      &\beta_{1j}
    \end{aligned}
  \end{array}
\right)
  &\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &\gamma_{0}^{\alpha} + \gamma_{1}^{\alpha}(\operatorname{condit}_{\operatorname{Varied}}) \\
      &\gamma^{\beta_{1}}_{0} + \gamma^{\beta_{1}}_{1}(\operatorname{condit}_{\operatorname{Varied}})
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{j}} & \rho_{\alpha_{j}\beta_{1j}} \\ 
     \rho_{\beta_{1j}\alpha_{j}} & \sigma^2_{\beta_{1j}}
  \end{array}
\right)
 \right)
    \text{, for id j = 1,} \dots \text{,J}
\end{aligned}
$$



### alt1

$$
\begin{align}
\text{Between-subjects level:} \\
y_{ij} &\sim \mathcal{N}\left(\alpha_{j[i]} + \beta_{1j[i]}(\texttt{condit}_{ij}) + \beta_{2j[i]}(\texttt{bandInt}_{ij}), \sigma^2\right) \\
\text{Group level:} \\
\begin{bmatrix}
\alpha_{j} \\
\beta_{1j} \\
\beta_{2j}
\end{bmatrix}
&\sim \mathcal{N}\left(
\begin{bmatrix}
\gamma_{0}^{\alpha} \\
\gamma_{0}^{\beta_{1}} + \gamma_{1}^{\beta_{1}}(\texttt{condit}_{\texttt{Varied}}) \\
\gamma_{0}^{\beta_{2}}
\end{bmatrix},
\begin{bmatrix}
\sigma^2_{\alpha_{j}} & 0 & 0 \\ 
0 & \sigma^2_{\beta_{1j}} & 0 \\
0 & 0 & \sigma^2_{\beta_{2j}}
\end{bmatrix}
\right), \text{ for id j = 1,} \dots \text{,J} \\
\text{Priors:} \\
\text{Intercept} &\sim \text{student}_t(3, 143.4, 212.7) \\
\texttt{bandInt} &\sim \text{(flat)} \\
\texttt{conditVaried} &\sim \text{(flat)} \\
\texttt{conditVaried:bandInt} &\sim \text{(flat)} \\
\textbf{L} &\sim \text{lkj\_corr\_cholesky}(1) \\
\textbf{sd} &\sim \text{student}_t(3, 0, 212.7) \\
\textbf{sigma} &\sim \text{student}_t(3, 0, 212.7)
\end{align}
$$


## 2

#### `dist ~ condit * bandInt + (1 + bandInt | id)`

- Correlated random slopes and intercepts for conditions and band intensity within subjects (identified by `id`).
- Estimates the following parameters:
    1. Fixed effects for conditions and band intensity, \\(\beta_0\), \\(\beta_1\), and \\(\beta_2\).
    2. Random intercepts for subjects, \\(\alpha_{j}\).
    3. Random slopes for subjects with respect to band intensity, \\(\beta_{2j}\).
    4. Correlation between intercepts \\(\alpha_{j}\) and slopes \\(\beta_{2j}\), captured in the covariance matrix.
- The model equation is represented as:

    \[
    \begin{aligned}
    y_{ij}  &\sim N \left(\alpha_{j[i]} + \beta_{1j[i]}(\operatorname{condit}_{ij}) + \beta_{2j[i]}(\operatorname{bandInt}_{ij}), \sigma^2 \right) \\
    \begin{pmatrix} \alpha_{j} \\ \beta_{1j} \\ \beta_{2j} \end{pmatrix} &\sim N \left( \begin{pmatrix} \gamma_{0}^{\alpha} \\ \gamma_{0}^{\beta_{1}} + \gamma_{1}^{\beta_{1}}(\operatorname{condit}_{\operatorname{Varied}}) \\ \gamma_{0}^{\beta_{2}} \end{pmatrix}, \begin{pmatrix} \sigma^2_{\alpha_{j}} & 0 & 0 \\ 0 & \sigma^2_{\beta_{1j}} & 0 \\ 0 & 0 & \sigma^2_{\beta_{2j}} \end{pmatrix} \right), \text{ for id j = 1,} \dots \text{,J}
    \end{aligned}
    \]

| formula | meaning |
| --- | --- |
| `(1\|id)` | random intercept for subject |
| `(bandInt\|id)` = `(1+bandInt\|id)` | random slope of band intensity within subjects, with correlated intercept |
| `condit * bandInt` | fixed effects of conditions and band intensity, and their interaction |


## 3

Certainly, here is the description of the model equations and coefficients, modified to match the requested style:

### Model Equations and Coefficients

- Model includes varying intercepts and slopes.
- Estimates multiple parameters:
    1. Population-level intercepts and slopes, represented by \(\gamma\).
    2. Group-level variances, represented by \(\sigma\).
    3. Correlations between different coefficients at the group level.

Formally, the model can be expressed as follows:

- Response for each observation:
    \[
    y_{ij} \sim N \left( \alpha_{j[i]} + \beta_{1j[i]}(\operatorname{condit}_{ij}) + \beta_{2j[i]}(\operatorname{bandInt}_{ij}), \sigma^2 \right)
    \]

- Random effects for each group:
    \[
    \begin{pmatrix} \alpha_{j} \\ \beta_{1j} \\ \beta_{2j} \end{pmatrix} \sim N \left( \begin{pmatrix} \gamma_{0}^{\alpha} \\ \gamma_{0}^{\beta_{1}} + \gamma_{1}^{\beta_{1}}(\operatorname{condit}_{\operatorname{Varied}}) \\ \gamma_{0}^{\beta_{2}} \end{pmatrix} , \begin{pmatrix} \sigma^2_{\alpha_{j}} & 0 & 0 \\ 0 & \sigma^2_{\beta_{1j}} & 0 \\ 0 & 0 & \sigma^2_{\beta_{2j}} \end{pmatrix} \right), \text{ for id } j = 1, \dots, J
    \]

| Equation (Model Code) | Meaning |
| --- | --- |
| `dist ~ condit * bandInt + (1 + bandInt\|id)` | Random slopes and intercepts for `condit` and `bandInt` within `id` group, with correlations between them. |

The model has been fitted using the `brm` function from the `brms` package, with a Gaussian family and identity link function. The prior distributions are mainly default settings with specific student t-distributions for some hyperparameters.

The equations provided outline the statistical structure of the model and the relationships between the different elements, such as the observations, random effects, and coefficients.



## 4

Certainly. Here's a modified description of the model equations and coefficients, matching the desired style of your alternate write-up:

### `dist ~ condit * bandInt + (1 + bandInt | id)`

- Correlated random slopes and intercepts for condition and band intensity within subjects.
- Model estimates include:
    1. Intercept, \\(\alpha_{j}\)
    2. Slope for condition, \\(\beta_{1j}\)
    3. Slope for band intensity, \\(\beta_{2j}\)
    4. Correlation between intercepts \\(\alpha_{j}\) and slopes \\(\beta_{1j}\), \\(\beta_{2j}\), given by the covariance matrix
    5. Residual error, \\(\sigma^2\)
- General form of the model:
    - \\(y_{ij} \sim N \left(\alpha_{j[i]} + \beta_{1j[i]}(\text{condit}_{ij}) + \beta_{2j[i]}(\text{bandInt}_{ij}), \sigma^2 \right)\)
    - \\(\begin{pmatrix} \alpha_{j} \\ \beta_{1j} \\ \beta_{2j} \end{pmatrix} \sim N \left( \begin{pmatrix} \gamma_{0}^{\alpha} \\ \gamma_{0}^{\beta_{1}} + \gamma_{1}^{\beta_{1}}(\text{condit}_{\text{Varied}}) \\ \gamma_{0}^{\beta_{2}} \end{pmatrix}, \begin{pmatrix} \sigma^2_{\alpha_{j}} & 0 & 0 \\ 0 & \sigma^2_{\beta_{1j}} & 0 \\ 0 & 0 & \sigma^2_{\beta_{2j}} \end{pmatrix} \right)\)

| equation | formula |
| --- | --- |
| \\(\alpha_{j} + \beta_{1j} \cdot \text{condit}_{ij} + \beta_{2j} \cdot \text{bandInt}_{ij} + \varepsilon_{ij}\\) | `dist ~ condit * bandInt + (1 + bandInt | id)` |

- Model code:
```R
e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id), data=test, file=paste0(here::here("data/model_cache",modelName)), iter=5000, chains=4)
```
- Family: gaussian 
- Link function: identity 
- Priors:
```R
e1_distBMM$prior
```




## 5

Certainly, based on the desired style you have provided, the revised Analyses Strategy section can be crafted as follows:

### `dist ~ condit * bandInt + (1 + bandInt | id)`

- **Mixed-Effects Regression with Correlated Random Slopes and Intercept**:
    - **Varying coefficients for individuals**: This model enables the estimation of the parameters at both individual and group levels. It encompasses partial pooling, estimating individual and group-level parameters.
    - **Model Equation**:

        \begin{align*}
    y_{ij}  &\sim N \left(\alpha_{j[i]} + \beta_{1j[i]}(\operatorname{condit}_{ij}) + \beta_{2j[i]}(\operatorname{bandInt}_{ij}), \sigma^2 \right) \\    
    \left( \begin{array}{c} \alpha_{j} \\ \beta_{1j} \\ \beta_{2j} \end{array} \right) &\sim N \left( \left( \begin{array}{c} \gamma_{0}^{\alpha} \\ \gamma_{0}^{\beta_{1}} + \gamma_{1}^{\beta_{1}}(\operatorname{condit}_{\operatorname{Varied}}) \\ \gamma_{0}^{\beta_{2}} \end{array} \right), \left( \begin{array}{ccc} \sigma^2_{\alpha_{j}} & 0 & 0 \\  0 & \sigma^2_{\beta_{1j}} & 0 \\ 0 & 0 & \sigma^2_{\beta_{2j}} \end{array} \right) \right) \text{, for id j = 1,} \dots \text{,J}
    \end{align*}



    - **Bayesian Estimation**: This method quantifies the uncertainty in parameter estimates and circumvents convergence issues. We report median values of the posterior distribution and 95% credible intervals.
    - **Implementation**: Fitting was performed using the `brms` package, and descriptive statistics were extracted with the `BayestestR` package.

| Equation | Formula | Description |
| --- | --- | --- |
| \((\beta_0 + \beta_{1}X_i + e_{si})\) | `~ X + (1|Subject)` | Bayesian Mixed Effects Regression Model |
| Model Code | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id), data=test, file=paste0(here::here("data/model_cache", modelName)), iter=5000, chains=4)` | Specifics of the model's implementation in R |

The provided R code and the graphical representations detail the implementation of this model for specific analyses.

Please make sure to replace placeholders (like `Subject`) with the actual terms used in your research or analysis if necessary. The above description is crafted to align with the desired style and provide comprehensive insights into the model's configuration.





## 6

Certainly. Here's a modified description for the model and coefficients in the desired style:

### `dist ~ condit * bandInt + (1 + bandInt | id)`

- Correlated random slopes and intercepts
- Estimates eight parameters:
    1. Global average for response, \\(\alpha_{j}\).
    2. Effect of condition on response, \\(\beta_{1j}\).
    3. Effect of band intensity on response, \\(\beta_{2j}\).
    4. Variability of intercepts, \\(\sigma^2_{\alpha_{j}}\).
    5. Variability of slope for condition, \\(\sigma^2_{\beta_{1j}}\).
    6. Variability of slope for band intensity, \\(\sigma^2_{\beta_{2j}}\).
    7. Variance of residual error, \\(\sigma^2\).
    8. Correlations between intercepts and slopes, not explicitly shown.

\begin{align*} 
y_{ij} &\sim N \left(\alpha_{j[i]} + \beta_{1j[i]}(\operatorname{condit}_{ij}) + \beta_{2j[i]}(\operatorname{bandInt}_{ij}), \sigma^2 \right)\\
\left( \begin{array}{c} \alpha_{j} \\ \beta_{1j} \\ \beta_{2j} \end{array} \right) &\sim N \left( \left( \begin{array}{c} \gamma_{0}^{\alpha} \\ \gamma_{0}^{\beta_{1}} + \gamma_{1}^{\beta_{1}}(\operatorname{condit}_{\operatorname{Varied}}) \\ \gamma_{0}^{\beta_{2}} \end{array} \right), \left( \begin{array}{ccc} \sigma^2_{\alpha_{j}} & 0 & 0 \\  0 & \sigma^2_{\beta_{1j}} & 0 \\ 0 & 0 & \sigma^2_{\beta_{2j}} \end{array} \right) \right) \text{, for id j = 1,} \dots \text{,J}
\end{align*}






| formula | meaning |
| --- | --- |
| `(1\|id)` | random group intercept |
| `(1 + bandInt\|id)` | random slope of band intensity within group with correlated intercept |

Model code: 

```r
e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id), data=test, file=paste0(here::here("data/model_cache", modelName)), iter=5000, chains=4)
```

In the model:
- `(1 + bandInt|id)` represents the random slope of band intensity within the group with correlated intercept.
- `condit * bandInt` represents the interaction between condition and band intensity.

Subsequent analysis and visualizations then assess these effects.

Please note that this revised description retains the essence of your analysis strategy while adapting to the desired style.





## 7

Certainly. Here is the revised description that matches the style of the alternate writeup:

### `dist ~ condit * bandInt + (1 + bandInt | id)`

- **Correlated random slopes and intercepts.**
- **Estimates various parameters:**
    1. Global average for the dependent variable, \\(\gamma_0^{\alpha}\).
    2. Effects of `conditVaried`, \\(\gamma_0^{\beta_{1}} + \gamma_{1}^{\beta_{1}}(\operatorname{condit}_{\operatorname{Varied}})\).
    3. Effects of `bandInt`, \\(\gamma_0^{\beta_{2}}\).
    4. Correlations between intercepts and slopes, represented by the covariance matrix.
    5. Residual variance, \\(\sigma^2\).
- **Equation for the model:**
    \\[
    y_{ij}  \sim N \left(\alpha_{j[i]} + \beta_{1j[i]}(\operatorname{condit}_{ij}) + \beta_{2j[i]}(\operatorname{bandInt}_{ij}), \sigma^2 \right) 
    \\]
    with 
    \\[
    \left(
      \begin{array}{c} 
        \alpha_{j} \\
        \beta_{1j} \\
        \beta_{2j}
      \end{array}
    \right)
      \sim N \left(
    \left(
      \begin{array}{c} 
        \gamma_{0}^{\alpha} \\
        \gamma_{0}^{\beta_{1}} + \gamma_{1}^{\beta_{1}}(\operatorname{condit}_{\operatorname{Varied}}) \\
        \gamma_{0}^{\beta_{2}}
      \end{array}
    \right)
    , 
    \left(
      \begin{array}{ccc}
         \sigma^2_{\alpha_{j}} & 0 & 0 \\ 
         0 & \sigma^2_{\beta_{1j}} & 0 \\
         0 & 0 & \sigma^2_{\beta_{2j}}
      \end{array}
    \right)
     \right)
        \text{, for id j = 1,} \dots \text{,J}
    \\]

| formula | meaning |
| --- | --- |
| `(1 | id)` | random individual intercept |
| `(1 + bandInt | id)` | random slope of `bandInt` within individuals with correlated intercept |
| `(condit * bandInt)` | interaction effect between `condit` and `bandInt` |

Model code and resulting outputs can be referenced in the R code section, including the visualizations, which illustrate the conditional effect of training condition and band, as well as the predicted means and marginal effects.


## 8 


Certainly. Based on the desired style of description, here's the modified content:

### Varying Coefficients

The analysis utilizes Bayesian methods to directly quantify uncertainty in parameter estimates, addressing common convergence issues found in frequentist methods. The models are summarized as follows:

### `(condit * bandInt + (1 + bandInt | id))`

-   The model estimates varying coefficients.
-   It estimates the relationship between condition, band intensity, and distance, incorporating random intercepts and slopes.
-   The model can be formulated as:
    -   \\(dist \approx (\\beta\_0 + b_{0,id}) + (\\beta\_1 + b_{1,id}) \cdot condit + (\\beta\_2 + b_{2,id}) \cdot bandInt + (\\beta\_3 + b_{3,id}) \cdot (condit \times bandInt) + e_{id}\\)
    -   Here, \\(b_{0,id}, b_{1,id}, b_{2,id},\\) and \\(b_{3,id}\\) are random effects for the individual, and \\(e_{id}\\) is the error term.
    -   \\(\\begin{pmatrix}b_{0,id} \\\\ b_{1,id} \\\\ b_{2,id} \\\\ b_{3,id}\\end{pmatrix} \\sim \\mathcal{N}\\left( \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0\\end{pmatrix},\\begin{pmatrix} \\sigma\_{00}^2 & \\sigma\_{01} & \\sigma\_{02} & \\sigma\_{03}\\\\ \\sigma\_{01} & \\sigma\_{11}^2 & \\sigma\_{12} & \\sigma\_{13}\\\\ \\sigma\_{02} & \\sigma\_{12} & \\sigma\_{22}^2 & \\sigma\_{23}\\\\ \\sigma\_{03} & \\sigma\_{13} & \\sigma\_{23} & \\sigma\_{33}^2\\end{pmatrix}\\right)\\)

| formula | meaning |
| --- | --- |
| `(1\|id)` | random individual intercept |
| `(bandInt\|id)` = `(1+bandInt\|id)` | random slope of band intensity within individual with correlated intercept |

The models' results are graphed, showing conditional effects of training condition and band, with ribbons indicating 95% credible intervals, and grand means and average marginal effects per condition and band.



## 9 

Certainly. Here is a revision of the description that aligns with the desired style:

### `dist ~ condit * bandInt + (1 + bandInt | id)`

- Models the relationship between the distance, training conditions, and velocity band, while accounting for individual variations.
- Estimates multiple parameters, including:
    1. Fixed effects of condition and velocity band interactions.
    2. Random intercept for individuals.
    3. Random slope of bandInt within individuals, with a correlated intercept.
    4. Gaussian family with identity link function.
- Various priors are applied:
    - Flat priors for coefficients.
    - Student's t-distribution priors for intercepts and standard deviations.
    - LKJ correlation priors for the correlation matrix.
- Formally described by:
    \[
    \begin{align*}
    Y_{i} & = \left( \beta_0 + b_{0i} \right) + \left( \beta_1 + b_{1i} \right) \cdot \text{condit} + \left( \beta_2 + b_{2i} \right) \cdot \text{bandInt} + e_{i} \\
    \begin{pmatrix} b_{0i} \\ b_{1i} \\ b_{2i} \end{pmatrix} & \sim \mathcal{N} \left( \begin{pmatrix} 0 \\ 0 \\ 0 \end{pmatrix}, \begin{pmatrix} \sigma_{00}^2 & \sigma_{01} & \sigma_{02} \\ \sigma_{01} & \sigma_{11}^2 & \sigma_{12} \\ \sigma_{02} & \sigma_{12} & \sigma_{22}^2 \end{pmatrix} \right)
    \end{align*}
    \]

| equation | formula |
| --- | --- |
| \\((\beta_0 + b_{0i}) + (\beta_1 + b_{1i})\cdot\text{condit} + (\beta_2 + b_{2i})\cdot\text{bandInt} + e_i\\) | `dist ~ condit * bandInt + (1 + bandInt | id)` |

The diagrams and figures represent:
- E1: Conditional Effect of Training Condition and Band, showing 95% Credible Intervals.
- E1: Predicted Means Per Condition and Band, and Average Marginal Effect (Constant - Varied).



## 10

Certainly. Here's a restructured description of the model equations and coefficients to match the requested style:

## Varying Coefficients

### Model Equations

| Equation                                                                                                           | Formula                                              |
|--------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
| \\(β\_0 + β\_{1}(\text{{condit}}) + β\_{2}(\text{{bandInt}}) + (1 + \text{{bandInt}} \| \text{{id}}) + e\_{si}\\)  | `dist ~ condit * bandInt + (1 + bandInt \| id)`      |

### Formula Meanings

| Formula                     | Meaning                                               |
|-----------------------------|-------------------------------------------------------|
| `(1\|id)`                   | random group intercept (individuals)                  |
| `(bandInt\|id)`             | random slope of bandInt within id group with correlated intercept |



## 11

Certainly. Below, I have transformed the original description into the desired style, providing an explanation of the model, connections between models, code, and conceptual ideas, and added tables to represent these connections visually.

### Analyses Strategy

We employed a Bayesian approach, permitting direct quantification of uncertainty in parameter estimates and avoiding frequentist convergence issues. The general form of the mixed models can be understood through the following representations:

#### Model Equations and Formulas

| Equation | Formula |
| --- | --- |
| \\(dist \sim condit \cdot bandInt + (1 + bandInt\mid id)\\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))` |
| \\(vx \sim condit \cdot bandInt + (1 + bandInt\mid id)\\) | `e1_vxBMM$formula` |

#### Formula Meaning

| Formula | Meaning |
| --- | --- |
| `(1\|id)` | Random intercept for individual |
| `(bandInt\|id)` = `(1+bandInt\|id)` | Random slope of `bandInt` within individual with correlated intercept |

#### Priors and Family

| Parameter | Description |
| --- | --- |
| Family: Gaussian | Link function: identity |
| Priors | default, vectorized, and specific as indicated in the model code |

#### Graphical Representation

```{tikz, model-structure1b, engine.opts=font_opts}
\usetikzlibrary{positioning}
\begin{tikzpicture}[{every node/.append style}=draw]
  \node [rectangle] (population) at (0, 4) {Population};
  \node [rectangle] (id) at (0, 2.5) {Individual (id)};
  \node [ellipse] (y1) at (-1.5, 1) {Condition (condit)};
  \node [ellipse] (y2) at (1.5, 1) {Band Intensity (bandInt)};
  \draw [-latex] (population) to (id);
  \draw [-latex] (id) to (y1);
  \draw [-latex] (id) to (y2);
\end{tikzpicture}
```




## 12

Certainly, the revised description that matches your desired style is as follows:

### Analyses Strategy

The analysis employs Bayesian methods to quantify the uncertainty in the parameter estimates, avoiding convergence issues common to frequentist analogues of mixed models. The representation of the model, as well as the corresponding code and conceptual ideas, can be summarized in tables and visuals as follows:

| Equation                                                                    | Formula                                       |
|----------------------------------------------------------------------------|-----------------------------------------------|
| \\((\beta_0 + \beta_1 \cdot \text{condit} + \beta_2 \cdot \text{bandInt}) + (1 + \text{bandInt}\|id)\\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt\|id))` |
| `(1\|id)`                                                                   | random intercept for id                       |
| `(x\|id)` = `(1+x\|id)`                                                     | random slope of x within id with correlated intercept |
| `(0+x\|id)` = `(-1+x\|id)`                                                  | random slope of x within id: no variation in intercept |

The detailed structure of the model can be visualized in the following diagram:

```{tikz, model-structure2, engine.opts=font_opts}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\begin{tikzpicture}[{every node/.append style}=draw]
  \node [rectangle] (id) at (0, 2.5) {ID};
  \node [ellipse] (dist1) at (-1.5, 1) {$\text{dist}_{1}$};
  \node [ellipse] (dist2) at (0, 1) {$\text{dist}_{2}$};
  \node [ellipse] (disti) at (1.5, 1) {$\text{dist}_{i}$};
  \draw [-latex] (id) to (dist1);
  \draw [-latex] (id) to (dist2);
  \draw [-latex] (id) to (disti);
\end{tikzpicture}
```

The priors for the model parameters are:


| prior                 | class    | coef                   | source     |
|-----------------------|----------|------------------------|------------|
| (flat)                | b        |                        | default    |
| (flat)                | b        | bandInt                | (vectorized)|
| (flat)                | b        | conditVaried            | (vectorized)|
| (flat)                | b        | conditVaried:bandInt    | (vectorized)|
| student_t(3, 143.4, 212.7) | Intercept |                  | default    |

The use of tables and visuals offers a clear connection between the equations, code, and underlying concepts, providing an insightful understanding of the model structure and the corresponding analysis strategy.



## 13

Certainly, here's the revised version of the analyses strategy that follows the desired style. It includes tables and visuals to illustrate the connections between the models, code, and conceptual ideas.

## Analyses Strategy

Our Bayesian method allows us to directly quantify the uncertainty in our parameter estimates, and avoid convergence issues. For each model, we report the median values of the posterior distribution, and 95% credible intervals. The models are represented as follows:

| equation | formula |
| --- | --- |
| \\((β\_0 + b\_{S,0s}) + (β\_{1} + b\_{S,1s}) \text{condit} + \text{bandInt} + e\_{si}\\) | `dist ~ condit * bandInt + (1 + bandInt | id)` |

| formula | meaning |
| --- | --- |
| `(1\|id)` | random group intercept |
| `(1+bandInt\|id)` | random slope of bandInt within group with correlated intercept |

The following table explains the parameters:



Graphical representation of the model structure:



This revised strategy provides a comprehensive overview of the models, coding implementations, and conceptual insights by leveraging tables and visuals for an in-depth yet succinct understanding.

## 14
Certainly. Based on the provided structure and style, here's a rewritten description:

## Analyses Strategy

The Bayesian methodology adopted here enables direct quantification of the uncertainty in our parameter estimates, avoiding the convergence issues commonly found in frequentist counterparts of our mixed models. The models and parameters are described through the following tables and visuals:

### Equations and Model Code

| Equation Description | Formula | Model Code |
| --- | --- | --- |
| General mixed-effects model with condition and bandInt | \\(β\_0 + β\_{1} \cdot \text{condit} + β\_{2} \cdot \text{bandInt} + b_{\text{id}} + e_{\text{si}}\\) | `dist ~ condit * bandInt + (1 + bandInt|id)` |

### Model Details

| Class | Coefficient | Prior | Source |
| --- | --- | --- | --- |
| b | - | (flat) | default |
| b | bandInt | (flat) | vectorized |
| b | conditVaried | (flat) | vectorized |
| b | conditVaried:bandInt | (flat) | vectorized |
| Intercept | - | student_t(3, 143.4, 212.7) | default |
| L | - | lkj_corr_cholesky(1) | default |
| L | id | lkj_corr_cholesky(1) | vectorized |
| sd | 0 | student_t(3, 0, 212.7) | default |
| sd | id | student_t(3, 0, 212.7) | vectorized |
| sd | bandInt | student_t(3, 0, 212.7) | vectorized |
| sd | Intercept | student_t(3, 0, 212.7) | vectorized |
| sigma | 0 | student_t(3, 0, 212.7) | default |

### Interpretation and Structure

You can further include an illustration of the model and description using TikZ as you have done in your desired style example.

### Parameter Summary



This structured representation provides a clear and comprehensive overview of the models, code, conceptual ideas, and visuals for the analyses strategy, aligning with the desired style.

## 15

Certainly. Here is the revised description of the analyses strategy in the requested style. I have presented the given model using tables and explanations to elucidate the connections between models, code, and conceptual ideas.

## Analyses Strategy

We utilize Bayesian methods, which allow us to directly quantify the uncertainty in our parameter estimates and avoid frequentist convergence issues. The general form of our models is presented below in the desired format:

| equation | formula |
| --- | --- |
| \\((\text{dist} \sim \text{condit} \times \text{bandInt} + (1 + \text{bandInt}\mid\text{id}))\\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))` |
| Family: gaussian | Link function: identity |

| formula | meaning |
| --- | --- |
| `(1\|id)` | random ID intercept |
| `(1 + bandInt\|id)` | random slope of bandInt within ID with correlated intercept |

The following table shows the prior distribution details:



And here's a representation of the connections between different components:



By employing the above structure, our model emphasizes the relationships between the target variable `dist`, the condition `condit`, banding intervals `bandInt`, and the identifiers `id`. The choice of the Bayesian model allows us to consider these relationships within a cohesive framework, accounting for the inherent variability and uncertainty.


## 16

Certainly. Below is the modified description, written in the requested style, emphasizing connections between models, code, and conceptual ideas, while utilizing tables and visuals.

## Analyses Strategy

Our utilization of Bayesian methodology permits direct quantification of uncertainty in our parameter estimates and avoids frequentist convergence issues. We delineate the median values of the posterior distribution and 95% credible intervals. Our models are described below:

| equation | formula |
| --- | --- |
| \\(e1\_distBMM \leftarrow brm(dist \sim condit \cdot bandInt + (1 + bandInt\|id))\\) | `gaussian` link function |

| formula | meaning |
| --- | --- |
| `(1\|id)` | random id intercept |
| `(x\|id)` = `(1+x\|id)` | random slope of x within id with correlated intercept |
| `(0+x\|id)` = `(-1+x\|id)` | random slope of x within id: no variation in intercept |

e1_distBMM$prior %>% 
  tidy() %>% 
  mutate(Parameter = c("b (flat)", "b (bandInt)", "b (conditVaried)", "b (conditVaried:bandInt)", "Intercept", "L", "sd", "sigma"),
         Description = c("Default flat prior", "Vectorized flat prior for bandInt", "Vectorized flat prior for conditVaried", "Vectorized flat prior for interaction", "Student's t prior for Intercept", "lkj_corr_cholesky for L", "Student's t prior for sd", "Student's t prior for sigma")) %>% 
  select(Parameter, Prior = prior, Description) %>% 
  kbl(escape = FALSE) %>% 
  kable_styling(full_width = FALSE)

```{tikz, model-structure3, engine.opts=font_opts}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\begin{tikzpicture}[{every node/.append style}=draw]
  \node [rectangle] (id) at (0, 2.5) {ID};
  \node [ellipse] (dist1) at (-1.5, 1) {$\text{dist}_{1}$};
  \node [ellipse] (dist2) at (0, 1) {$\text{dist}_{2}$};
  \node [ellipse] (disti) at (1.5, 1) {$\text{dist}_{i}$};
  \draw [-latex] (id) to (dist1);
  \draw [-latex] (id) to (dist2);
  \draw [-latex] (id) to (disti);
\end{tikzpicture}
```

This modified description aligns with the requested style by utilizing tables to succinctly represent connections between different aspects of the model, and visuals to present the structure.

## 17

Certainly. Below is the revised version of the current description, adapted to match the desired style:

## Analyses Strategy

Our Bayesian approach allows direct quantification of uncertainty in parameter estimates, circumventing common convergence issues in frequentist analogues of our mixed models. We report the median values of the posterior distribution, and 95% credible intervals.

| equation | formula |
| --- | --- |
| \\( e1\_distBMM \sim \text{dist} + \text{condit} \times \text{bandInt} + (1 + \text{bandInt}\mid\text{id}) \\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))` |
| Family: gaussian  | Link function: identity |
| Prior: \\((\text{flat}), \text{student}_t(3, 143.4, 212.7)\, \text{Intercept}, \text{lkj\_corr\_cholesky(1)}, \text{student}_t(3, 0, 212.7)\, \text{sd}, \text{sigma} \\) | `e1_distBMM$prior` |

| formula | meaning |
| --- | --- |
| `(1\|id)` | random ID intercept |
| `(x\|id)` = `(1+x\|id)` | random slope of x within ID with correlated intercept |
| `(0+x\|id)` = `(-1+x\|id)` | random slope of x within ID: no variation in intercept |

```{r}
# e1_distBMM_prior <- e1_distBMM$prior %>%
#   mutate(Class = c("b", "b", "b", "b", "Intercept", "L", "L", "sd", "sd", "sd", "sd", "sigma"),
#          Description = c("(flat)", "(flat)", "(flat)", "(flat)", "student_t(3, 143.4, 212.7)", "lkj_corr_cholesky(1)", "lkj_corr_cholesky(1)", "student_t(3, 0, 212.7)", "student_t(3, 0, 212.7)", "student_t(3, 0, 212.7)", "student_t(3, 0, 212.7)", "student_t(3, 0, 212.7)")) %>%
#   select(Parameter = coef, Class, Description) %>%
#   kbl(escape = FALSE) %>%
#   kable_styling(full_width = FALSE)
```

```{tikz, model-structure4, engine.opts=font_opts}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\begin{tikzpicture}[{every node/.append style}=draw]
  \node [rectangle] (id) at (0, 2.5) {ID};
  \node [ellipse] (dist1) at (-1.5, 1) {$\text{dist}_{1}$};
  \node [ellipse] (dist2) at (0, 1) {$\text{dist}_{2}$};
  \node [ellipse] (disti) at (1.5, 1) {$\text{dist}_{i}$};
  \draw [-latex] (id) to (dist1);
  \draw [-latex] (id) to (dist2);
  \draw [-latex] (id) to (disti);
\end{tikzpicture}
```

This rewrite aligns the description with the alternate writeup style, emphasizing tables and visual structure. It connects models, code, and conceptual ideas, creating a comprehensive overview of the analysis strategy.





## 18

Certainly. Below is the revised description of the model equations and coefficients in the desired style, utilizing tables and visual representations to convey the structure of the model. Note that some of the detailed connections between the original model code and the conceptual ideas must be inferred from the code, so the following restructured content may need further customization to precisely fit the specific context of your analysis.

## Analyses Strategy

The Bayesian approach used in our analyses directly quantifies the uncertainty in our parameter estimates, and circumvents convergence issues common to the frequentist analogues of our mixed models. The representation below connects the model's components with the associated code and conceptual ideas:

| Equation                                                | Formula                                                  |
|---------------------------------------------------------|----------------------------------------------------------|
| \\(e1\_distBMM = \text{dist} \sim \text{condit} \cdot \text{bandInt} + (1 + \text{bandInt}\mid\text{id})\\) | `brm(dist ~ condit * bandInt + (1 + bandInt|id))`        |
| As represented in the code                              | `Family: gaussian` `Link function: identity`             |

Priors for the above model are shown below:

| Prior                        | Class      | Coef                      | Source    |
|------------------------------|------------|----------------------------|-----------|
| \\(\text{(flat)}\\)                    | b          |                            | default   |
| \\(\text{(flat)}\\)                    | b          | bandInt                   | vectorized |
| \\(\text{(flat)}\\)                    | b          | conditVaried               | vectorized |
| \\(\text{(flat)}\\)                    | b          | conditVaried:bandInt       | vectorized |
| \\(\text{student\_t}(3, 143.4, 212.7)\\) | Intercept  |                            | default   |

Visual representation of the model's structure:

```{tikz, model-structure5, engine.opts=font_opts}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\begin{tikzpicture}[{every node/.append style}=draw]
  \node [rectangle] (id) at (0, 2.5) {ID};
  \node [ellipse] (dist1) at (-1.5, 1) {$\text{dist}_{1}$};
  \node [ellipse] (dist2) at (0, 1) {$\text{dist}_{2}$};
  \node [ellipse] (disti) at (1.5, 1) {$\text{dist}_{i}$};
  \draw [-latex] (id) to (dist1);
  \draw [-latex] (id) to (dist2);
  \draw [-latex] (id) to (disti);
\end{tikzpicture}
```

This revised description integrates the use of tables and visuals, linking the equations, the associated code, and the underlying conceptual ideas, in line with the desired style.




## 19

Certainly. Here's the rewritten description, formatted in line with your requirements and making connections between models, code, and conceptual ideas through tables and visuals.

## Analyses Strategy

Our analyses leverage Bayesian methods to directly quantify uncertainty in our parameter estimates. This methodology effectively avoids convergence issues typically associated with frequentist counterparts in mixed models. We present our models as follows:

### Equations and Model Code

| Model Equation                                                                                          | Model Code                                   |
|--------------------------------------------------------------------------------------------------------|----------------------------------------------|
| \\( \beta\_0 + \beta\_{1}\text{condit} \times \text{bandInt} + \epsilon \)                              | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))` |
| \\( \beta\_0 + \beta\_{1}\text{condit} \times \text{bandInt} + \text{Random Effect}\_{\text{id}} + \epsilon \) | `∼ condit * bandInt + (1 + bandInt|id)`     |

### Model Structure

The general structure of our model is illustrated in the diagram below, where the relationship between the ID and different distances is demonstrated.

### Parameter Description

A concise description of the model parameters is given below, including their notation, corresponding code, and meaning in the context of the study.

| Parameter      | Term           | Description                                                                | Estimate      |
|----------------|----------------|----------------------------------------------------------------------------|---------------|
| \\( \beta_0 \) | `<code>condit</code>`  | Global average effect of condition across subjects                           | <estimate>   |
| \\( \beta_1 \) | `<code>bandInt</code>` | Effect of interaction between conditions and banding intensity on distances | <estimate>   |

The table can be further customized with relevant estimates obtained from fitting the model.

### Summary

The methodological approach herein aligns with the required emphasis on tables that convey connections between models, code, and concepts. The inclusion of visuals further assists in comprehending the structure of the model.




## 20


Certainly. Below is a revised description that aligns with the requested style. The content has been reformulated to match the desired presentation style with tables and visuals. 

## Analyses Strategy

The utilization of Bayesian methods in our analysis provides direct quantification of uncertainty in parameter estimates and circumvents convergence issues commonly found with frequentist counterparts. The models' representation and interpretation are described below.

| equation | formula |
| --- | --- |
| \\(e1\_distBMM = dist \sim condit \cdot bandInt + (1 + bandInt\|id)\\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt\|id))` |

| formula | meaning |
| --- | --- |
| `(1\|id)` | random intercept for individual (ID) |
| `(1 + bandInt\|id)` | random slope of bandInt within individual with correlated intercept |

This table demonstrates the relationship between the equation and the code representation for the modeling of the data.

The accompanying figure displays the structure of the model, emphasizing the individual identifiers (ID) and the different distances (dist) for each observation.



This visualization supports the conceptual understanding of how individual identifiers are related to the distances in the dataset.

Lastly, additional statistics such as median values and 95% credible intervals can be presented in a concise tabular form. For instance:

```R
#| eval: false
fit %>% 
  tidy() %>% 
  mutate(Parameter = c("\\(e1\_distBMM\\)", "\\(\\beta_0\\)", "\\(\\beta_1\\)"),
         Description = c("Model for distance by condition and bandInt",
                         "Global average of parameter",
                         "Effect of variable on parameter")) %>% 
  mutate(term = glue::glue("<code>{term}</code>"),
         estimate = round(estimate, 3)) %>% 
  select(Parameter, Term = term, Description, Estimate = estimate) %>% 
  kbl(escape = FALSE) %>% 
  kable_styling(full_width = FALSE)
```

This approach ensures a clear and consistent representation of the analyses strategy, in line with the requested style.



## 21

Certainly. Here's a revised version of the analysis strategy section, matching the desired style with an emphasis on tables and visuals.

## Analyses Strategy

We employ Bayesian methods for quantifying the uncertainty in our parameter estimates and addressing convergence issues that are common in frequentist mixed models. The models are presented in the table below along with their corresponding formulae and descriptions. The general form is explained with relevant coefficients:

| equation | formula |
| --- | --- |
| \\(e1\_distBMM = (β\_0 + b\_{I,0i}) + (β\_1 + b\_{S,1s}) \times \text{{condit}} + \text{{bandInt}} + (1 + \text{{bandInt}}\|id)\\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))` |

| formula | meaning |
| --- | --- |
| `(1\|id)` | Random intercept for ID |
| `(condit * bandInt\|id)` | Interaction of condition and band interval within ID |

The fit can be summarized and presented using:

```r
#| eval: false
fit %>%
  tidy() %>%
  mutate(Parameter = c("\\(β_0\\)", "\\(β_1\\)", "\\(σ_{0}\\)", "\\(σ_{y}\\)"),
         Description = c("Global Intercept",
                         "Interaction between condition and band interval",
                         "Between-ID variability",
                         "Within-ID variability")) %>%
  mutate(term = glue::glue("<code>{term}</code>"),
         estimate = round(estimate, 3)) %>%
  select(Parameter, Term = term, Description, Estimate = estimate) %>%
  kbl(escape = FALSE) %>%
  kable_styling(full_width = FALSE)
```

A visual representation of the hierarchical structure and distributional assumptions is provided:

```{tikz e1_distBMM_structure, engine.opts=font_opts}
#| fig-cap: "Hierarchical structure of our Bayesian mixed model, showcasing the interaction of condition and band interval within subject IDs."

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{backgrounds}
\definecolor{indiv}{HTML}{5F4690}
\definecolor{indiv1}{HTML}{CBBAF7}
\definecolor{choice}{HTML}{E17C05}
\definecolor{choice1}{HTML}{F7C694}
\begin{tikzpicture}[{every node/.append style}=draw]
  \node [rectangle, draw=none, fill=indiv1] (id) at (0, 2.5) {ID};
  \node [ellipse, fill=choice1, draw=none] (dist) at (0, 1) {dist};
  \node [ellipse, fill=choice, draw=none] (condit) at (-1.5, 1) {condit};
  \node [ellipse, fill=choice, draw=none] (bandInt) at (1.5, 1) {bandInt};

  \draw [-latex] (id) to (dist);
  \draw [-latex] (id) to (condit);
  \draw [-latex] (id) to (bandInt);

  \node [rectangle] (population) at (0, 4) {Population of Subjects};
  \draw [-latex] (population) to (id);

  \node [rounded corners, draw=none, align=center, fill=indiv, text=white] 
    (note_id) at (-1.5, 3.75) 
    {\textsf{Random effects:}\\\texttt{id}};
  \node [rounded corners, draw=none, align=center, fill=choice, text=white] 
    (note_variables) at (1.5, 3.75) 
    {\textsf{Fixed effects:}\\\texttt{condit, bandInt}};
\end{tikzpicture}
```

This diagram visually conveys the structure of the model with fixed effects for condition and band interval, and random effects for subject IDs. It also displays the relationship between the different components of the model.






## 22


Certainly. Below is the revised description, aligned with the desired style you specified.

## Analyses Strategy

Utilizing Bayesian methods enables us to precisely quantify the uncertainty in our parameter estimates and bypass convergence issues found in frequentist counterparts of our mixed models. For each model, we report median values of the posterior distribution and 95% credible intervals.

The general structure of our models can be presented in the following manner:

| equation | formula |
| --- | --- |
| \\( \text{dist} \sim \text{condit} \times \text{bandInt} + (1 + \text{bandInt} \mid \text{id}) \\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))` |

| formula | meaning |
| --- | --- |
| `(1\|id)` | random intercept for subjects |
| `(condit\|id)` | random slope of condition within subjects with correlated intercept |
| `(bandInt\|id)` | random slope of bandInt within subjects: no variation in intercept |


The parameters can be summarized as follows:

fit %>%
  tidy() %>%
  mutate(Parameter = c("\\(\\beta_0\\)", "\\(\\beta_1\\)", "\\(\\beta_2\\)", "\\(\\sigma_0\\)", "\\(\\sigma_y\\)")) %>%
  mutate(Description = c("Global average dist across all subjects",
                         "Effect of condit on dist for all subjects",
                         "Effect of bandInt on dist for all subjects",
                         "Between-cluster variability of average dist",
                         "Within-cluster variability of dist")) %>%
  mutate(term = glue::glue("<code>{term}</code>"),
         estimate = round(estimate, 3)) %>%
  select(Parameter, Term = term, Description, Estimate = estimate) %>%
  kbl(escape = FALSE) %>%
  kable_styling(full_width = FALSE)

```{tikz e1_distBMM-structure-annotated, engine.opts=font_opts}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{backgrounds}
\definecolor{indiv}{HTML}{5F4690}
\definecolor{indiv1}{HTML}{CBBAF7}
\definecolor{choice}{HTML}{E17C05}
\definecolor{choice1}{HTML}{F7C694}
\begin{tikzpicture}[{every node/.append style}=draw]
  \node [rectangle, draw=none, fill=indiv1] (id) at (0, 2.5) {ID};
  
  \node [ellipse, fill=choice1, draw=none] (dist) at (0, 1) {dist};
  \node [ellipse, fill=choice, draw=none] (condit) at (-1.5, 1) {condit};
  \node [ellipse, fill=choice, draw=none] (bandInt) at (1.5, 1) {bandInt};

  \draw [-latex] (id) to (dist);
  \draw [-latex] (id) to (condit);
  \draw [-latex] (id) to (bandInt);

  \node [rectangle] (population) at (0, 4) {Population of Subjects};
  \draw [-latex] (population) to (id);

  \node [rounded corners, draw=none, align=center, fill=indiv, text=white] 
    (note_id) at (-1.5, 3.75) 
    {\textsf{Random effects:}\\\texttt{id}};
  \node [rounded corners, draw=none, align=center, fill=choice, text=white] 
    (note_variables) at (1.5, 3.75) 
    {\textsf{Fixed effects:}\\\texttt{condit, bandInt}};
\end{tikzpicture}
```

This revised presentation of the model offers a more comprehensive visualization of the hierarchical structure and distributional assumptions. It aligns the model description with the alternate writeup style that emphasizes connections between models, code, and conceptual ideas through tables and visual representation.



## 23

Certainly. Based on your request, the revised description of the model equations and coefficients, as well as the tikz graphing, is as follows:

### Analyses Strategy

The modeling strategy that we employ in this research can be best described using a Bayesian approach. It allows us to specifically quantify uncertainty in our parameter estimates. To establish a connection between models, code, and conceptual ideas, we present an organized table detailing the structure of the model, and an elaborate tikz graphic portraying the hierarchical structure and distributional assumptions of our model.

#### Model Structure

The general form of our models can be represented in a structured way as shown below:

| equation | formula | description |
| --- | --- | --- |
| \\( e1\_distBMM \sim \text{{condit}} \ast \text{{bandInt}} + (1 + \text{{bandInt}}\|id) \\) | `brm(dist ~ condit * bandInt + (1 + bandInt\|id))` | Mixed-effects model with random intercept and slope for bandInt within ID |

Here is a breakdown of the specific meanings of the elements in the equation:

| formula | meaning |
| --- | --- |
| `(1\|id)` | Random intercept for ID |
| `(bandInt\|id)` | Random slope of bandInt within ID |

The model can be fit and summarized in R:

```r
#| eval: false
fit <- brm(dist ~ condit * bandInt + (1 + bandInt|id))
fit_summary <- fit %>%
  tidy() %>%
  mutate(Parameter = c("\\(\\beta_0\\)", "\\(\\beta_1\\)", "\\(\\sigma_0\\)", "\\(\\sigma_y\\)"),
         Description = c("Intercept", "Effect of condition and bandInt interaction", "Random effect of bandInt", "Error term")) %>%
  select(Parameter, Term = term, Description, Estimate = round(estimate, 3)) %>%
  kbl(escape = FALSE) %>%
  kable_styling(full_width = FALSE)
```

#### Hierarchical Structure

The graphical representation below conveys the hierarchical structure and distributional assumptions of our model:

```{tikz model-hierarchical-structure444, engine.opts=font_opts}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{backgrounds}
\definecolor{indiv}{HTML}{5F4690}
\definecolor{indiv1}{HTML}{CBBAF7}
\definecolor{choice}{HTML}{E17C05}
\definecolor{choice1}{HTML}{F7C694}
\begin{tikzpicture}[{every node/.append style}=draw]
  \node [rectangle, draw=none, fill=indiv1] (id) at (0, 2.5) {ID};
  
  \node [ellipse, fill=choice1, draw=none] (dist) at (0, 1) {dist};
  \node [ellipse, fill=choice, draw=none] (condit) at (-1.5, 1) {condit};
  \node [ellipse, fill=choice, draw=none] (bandInt) at (1.5, 1) {bandInt};

  \draw [-latex] (id) to (dist);
  \draw [-latex] (id) to (condit);
  \draw [-latex] (id) to (bandInt);

  \node [rectangle] (population) at (0, 4) {Population of Subjects};
  \draw [-latex] (population) to (id);

  \node [rounded corners, draw=none, align=center, fill=indiv, text=white] 
    (note_id) at (-1.5, 3.75) 
    {\textsf{Random effects:}\\\texttt{id}};
  \node [rounded corners, draw=none, align=center, fill=choice, text=white] 
    (note_variables) at (1.5, 3.75) 
    {\textsf{Fixed effects:}\\\texttt{condit, bandInt}};
\end{tikzpicture}
```

The visual representation illustrates the mixed-effects model, where individual differences in distance are nested in conditions and band interactions within subjects. The random effects are associated with the ID, and the fixed effects are associated with the condition and band interactions.

## 24 


## Analysis Strategy

We have employed a Bayesian method to quantify uncertainty in parameter estimates, sidestepping convergence problems that can occur in frequentist counterparts of mixed models. For every model, median values of the posterior distribution and 95% credible intervals are provided. The model can be described as follows:

| equation | formula |
| --- | --- |
| \\(e1\_distBMM \sim \text{{condit}} \times \text{{bandInt}} + (1 + \text{{bandInt}}|id)\\) | `dist ~ condit * bandInt + (1 + bandInt|id)` |

| formula | meaning |
| --- | --- |
| `(1\|id)` | random id intercept |
| `(1 + bandInt\|id)` | random slope of `bandInt` within `id` with correlated intercept |

The model's structure can be visualized through the following diagram:

```{tikz minivan-multilevel-structure-annotated56, engine.opts=font_opts}

\usetikzlibrary{positioning}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{backgrounds}
\definecolor{indiv}{HTML}{5F4690}
\definecolor{indiv1}{HTML}{CBBAF7}
\definecolor{choice}{HTML}{E17C05}
\definecolor{choice1}{HTML}{F7C694}
\begin{tikzpicture}[{every node/.append style}=draw]
  \node [rectangle, draw=none, fill=indiv1] (id) at (0, 2.5) {ID};
  \node [ellipse, fill=choice1, draw=none] (dist) at (0, 1) {dist};
  \node [ellipse, fill=choice, draw=none] (condit) at (-1.5, 1) {condit};
  \node [ellipse, fill=choice, draw=none] (bandInt) at (1.5, 1) {bandInt};

  \draw [-latex] (id) to (dist);
  \draw [-latex] (id) to (condit);
  \draw [-latex] (id) to (bandInt);

  \node [rectangle] (population) at (0, 4) {Population of Subjects};
  \draw [-latex] (population) to (id);

  \node [rounded corners, draw=none, align=center, fill=indiv, text=white] 
    (note_id) at (-1.5, 3.75) 
    {\textsf{Random effects:}\\\texttt{id}};
  \node [rounded corners, draw=none, align=center, fill=choice, text=white] 
    (note_variables) at (1.5, 3.75) 
    {\textsf{Fixed effects:}\\\texttt{condit, bandInt}};
\end{tikzpicture}


```


## 25

j &= \\beta\_{0\_j} + \\beta_{1}X_{i} \\\\ \\beta\_{0\_j} &\\sim \\mathcal{N}(\\beta\_{0}, \\sigma_{0}) \\\\ \\beta\_{1} &\\sim \\mathcal{N}(0, \\sigma\_{1}) \\\\ \\sigma_{y}, \\sigma\_{0}, \\sigma\_{1} &\\sim \\text{Exponential}(1) \\end{aligned} \\\] | \\\[ \\begin{aligned} \\mu &= X\\beta + Z\\gamma + \\epsilon \\\\ \\gamma &\\sim \\mathcal{N}(0, \\Sigma) \\end{aligned} \\\] |
| Random slope and intercept, correlated | `y ~ x + (1 + x \| group)` | \\\[ \\begin{aligned} Y\_{i\_j} &\\sim \\mathcal{N}(\\mu\_{i\_j}, \\sigma\_y) \\\\ \\mu\_{i\_j} &= (\\beta\_{0\_j} + \\beta\_{1\_j}X_{i}) \\\\ \\left(\\begin{array}{c} \\beta\_{0\_j} \\\\ \\beta\_{1\_j} \\end{array}\\right) &\\sim \\mathcal{N}\\left(\\left(\\begin{array}{c} \\beta\_{0} \\\\ \\beta\_{1} \\end{array}\\right), \\Sigma\\right) \\\\ \\beta\_{0} &\\sim \\mathcal{N}(0, \\sigma\_{0}) \\\\ \\beta\_{1} &\\sim \\mathcal{N}(0, \\sigma\_{1}) \\\\ \\sigma_{y}, \\sigma\_{0}, \\sigma\_{1} &\\sim \\text{Exponential}(1) \\end{aligned} \\\] | \\\[ \\begin{aligned} \\mu &= X\\beta + Z\\gamma + \\epsilon \\\\ \\gamma &\\sim \\mathcal{N}(0, \\Sigma) \\end{aligned} \\\] |
| Random slope only | `y ~ x + (0 + x \| group)` | \\\[ \\begin{aligned} Y\_{i\_j} &\\sim \\mathcal{N}(\\mu\_{i\_j}, \\sigma\_y) \\\\ \\mu\_{i\_j} &= \\beta\_{0} + \\beta\_{1\_j}X_{i} \\\\ \\beta\_{1\_j} &\\sim \\mathcal{N}(\\beta\_{1}, \\sigma\_{1}) \\\\ \\beta\_{0} &\\sim \\mathcal{N}(0, \\sigma\_{0}) \\\\ \\beta\_{1} &\\sim \\mathcal{N}(0, \\sigma\_{1}) \\\\ \\sigma_{y}, \\sigma\_{0}, \\sigma\_{1} &\\sim \\text{Exponential}(1) \\end{aligned} \\\] | \\\[ \\begin{aligned} \\mu &= X\\beta + Z\\gamma + \\epsilon \\\\ \\gamma &\\sim \\mathcal{N}(0, \\Sigma) \\end{aligned} \\\] |

## Model Description in Reference to the Existing Code

The following table and description connect the code, conceptual ideas, and the structure of the model:

| Conceptual Description | Code | Model Equation |
| --- | --- | --- |
| Mixed model with condition and band interval as fixed effects and random intercept and slope for band interval within subjects | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt\|id))` | \\\[\\text{dist} \sim \\beta\_{0} + \\beta\_{1} \\text{condit} + \\beta\_{2} \\text{bandInt} + (\\beta\_{3} + b\_{S,3s})\\text{bandInt} + (\\beta\_{0} + b\_{I,0i}) + e_{si}\\\] |

## Graphical Representation of Hierarchical Structure and Distributional Assumptions

For a comprehensive and visual representation of the hierarchical structure and distributional assumptions of the model, a more elaborated TikZ graphing will be implemented, showcasing all the key components, connections, and assumptions within the model.

The TikZ code for the graphical representation would require extensive detail, and could be produced based on the specific requirements and understanding of the hierarchical structure of the model. Please provide the required elements and relationships to be included in the diagram for precise code creation.

## 26

Certainly. Here's the revised description in the desired style:

## Analyses Strategy

In the Bayesian framework, we quantify the uncertainty in our parameter estimates, circumventing convergence issues. We report median values of the posterior distribution and 95% credible intervals for our mixed models. The specific representation of our models is detailed below:

| equation | formula |
| --- | --- |
| \\(e1\_distBMM \\sim dist \,+\, condit \ast bandInt \,+\, (1 \,+\, bandInt\|id)\\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt\|id))` |

| formula | meaning |
| --- | --- |
| `(1\|id)` | random intercept for subjects (`id`) |
| `(1+bandInt\|id)` | random slope of `bandInt` within subjects, with correlated intercept |

## Full {brms} model

This complex yet powerful model enables us to account for individual-specific differences across features. The model with priors is more formally defined as:

\\[
\begin{aligned}
&\ \textbf{Response} \\\\
e1\_distBMM \sim&\ dist \,+\, condit \ast bandInt \,+\, (1 \,+\, bandInt\|id) \\\\\[10pt\]
&\ \textbf{Priors} \\\\
\text{For example,}\\
\beta\_{0 \dots 7} \sim&\ \mathcal{N} (0, 3) \qquad\ \[\\text{Prior for fixed effects}\] \\\\
\sigma\_{\beta\_{0 \dots 7}} \sim&\ \operatorname{Exponential}(1) \qquad \[\\text{Prior for random effects}\] \\\\
\rho \sim&\ \operatorname{LKJ}(1) \qquad\ \[\\text{Prior for correlation between random effects}\]
\end{aligned}
\\]

| | Formula syntax | Full \\(\\beta\\) notation |
| --- | --- | --- |
| Random intercept | `y ~ x + (1 \| id)` | \\[ Y\_{i\_j} \sim \mathcal{N}(\mu\_{i\_j}, \sigma\_y) \\\\ \mu\_{i\_j} = \beta_0 + b_{I,0i} \\\] |
| Random slope | `y ~ x + (1 + bandInt\|id)` | \\[ Y\_{i\_j} \sim \mathcal{N}(\mu\_{i\_j}, \sigma\_y) \\\\ \mu\_{i\_j} = \beta_0 + b_{I,0i} + (\beta_1 + b_{S,1s}) \cdot X_i \\\] |

This restructuring aligns with the requested emphasis on tables and visual aids. If you require a TikZ diagram for the hierarchical structure and distributional assumptions, kindly provide further specifications to generate the desired figure.

## 27

Certainly, here is the revised description according to the requested style:

## Analyses Strategy

The given Bayesian method allows direct quantification of the uncertainty in our parameter estimates, alongside circumventing convergence issues common to the frequentist analogues of our mixed models. The general form of the model is represented in the table and formula syntax:

| Equation | Formula |
| --- | --- |
| \\( e1\_distBMM = (β\_0 + b\_{I,0i}) + (β\_{1} + b\_{S,1s}) \cdot \text{condit} \cdot \text{bandInt} + (1 + \text{bandInt}\|id) \\) | `dist ~ condit * bandInt + (1 + bandInt\|id)` |

### Hierarchical Structure

We illustrate the model's hierarchical structure through equation components and R code.

#### Connections between Models, Code, and Conceptual Ideas

| Equation Component | Meaning |
| --- | --- |
| \\( e1\_distBMM \\) | Model code for the mixed effect |
| \\( β\_0 + b\_{I,0i} \\) | Intercept term |
| \\( (β\_{1} + b\_{S,1s}) \cdot \text{condit} \cdot \text{bandInt} \\) | Interaction effect of condition and band interval |
| \\( (1 + \text{bandInt}\|id) \\) | Random slope and intercept by ID |

#### Visuals Conveying the Structure of the Model

For a detailed visual representation, the TikZ code below can be used to depict the hierarchical structure and distributional assumptions of our model:

```latex
\documentclass{standalone}
\usepackage{tikz}
\begin{document}
\begin{tikzpicture}
  \node {Model: \( e1\_distBMM \)}
    child { node {Intercept: \( β\_0 + b\_{I,0i} \)} }
    child { node {Effects: \( (β\_{1} + b\_{S,1s}) \cdot \text{condit} \cdot \text{bandInt} \)} }
    child { node {Random Effects: \( (1 + \text{bandInt}\|id) \)} };
\end{tikzpicture}
\end{document}
```

## Full {brms} Model

The formulation of the model is given as above, including both the equation and the associated formula syntax. It includes complexities such as individual-specific differences and various features that can be further tailored as needed.

The priors and the entire structure of the model can be conveyed through both tabular and visual representation, linking equations, code, and conceptual ideas in a coherent framework.

The revised description emphasizes tables and visuals that connect models, code, and conceptual ideas, and it includes a more elaborate TikZ graphing that showcases the hierarchical structure and distributional assumptions of the model.


## 28 


Certainly. Here's a revision of the provided description, incorporating the alternate style using tables and visuals.

### Analyses Strategy

The use of Bayesian methods facilitates the direct quantification of uncertainty in parameter estimates and sidesteps convergence issues commonly observed in frequentist analogues of mixed models. For each model, the median values of the posterior distribution and 95% credible intervals are reported. The general form of the models is presented through the following tables and equations:

#### Model Description

| Equation                                              | Model Code                                                   |
|-------------------------------------------------------|--------------------------------------------------------------|
| \(β_0 + β_{1}\text{condit} + β_{2}\text{bandInt} + e_{si}\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))` |

#### Formula Meaning

| Formula               | Meaning                                                                                         |
|-----------------------|-------------------------------------------------------------------------------------------------|
| `(1\|id)`             | Random intercept within id                                                                      |
| `(condit\|id)`        | Random slope of condition within id with correlated intercept                                    |
| `(0+bandInt\|id)`     | Random slope of bandInt within id: no variation in intercept                                     |

### The Full {brms} Model

The described model is complex, encompassing various constituent parts, yet it offers significant analytical strength. It enables the accommodation of individual-specific differences across numerous features.

Let's define the model more formally again, this time with priors for the parameters that will be estimated:

\[ \begin{aligned} &\textbf{Multinomial probability of selection of choice}_i \textbf{ in respondent}_j \\\\ \text{Choice}_{i_j} \sim& \operatorname{Categorical}(\{\mu_{1,i_j}, \mu_{2,i_j}, \mu_{3,i_j}\}) \\\\[10pt\] \ldots \end{aligned} \]

|                   | Formula Syntax           | Full \(\\beta\) Notation   | Offset Notation |
|-------------------|--------------------------|---------------------------|-----------------|
| Random Intercept  | `y ~ x + (1 \| group)`   | \[\begin{aligned} Y_{i_j} &\sim \mathcal{N}(\mu_{i_j}, \sigma_y) \\\\[5pt] \mu_{i_j} &= \beta_0 + \beta_{1}X_{i} + e_{si} \end{aligned}\] | \[\ldots\] |

### TikZ Graphing (Hierarchical Structure & Distributional Assumptions)

Creating a more elaborate TikZ graph showcasing the hierarchical structure and distributional assumptions of the model would require specifying further details about the hierarchical nature of the data and the structure of the model. Kindly provide the necessary information for creating this graphical representation.

By presenting the model in this manner, the connections between the equations, code, and conceptual ideas are emphasized, and the structure of the model is conveyed visually.


## 29

Certainly. Below, I've translated the existing description of the model and code into the alternate style requested, including tables that clarify the connections between the models, code, and conceptual ideas. I've focused on translating the specific mixed model formula into the desired format, and I've omitted the extensive equation detailing the full {brms} model, as the user's request seems mainly concerned with the mixed model itself.

### Analyses Strategy

Our use of Bayesian methods facilitates the direct quantification of uncertainty in parameter estimates, and avoids convergence problems often encountered with the frequentist counterparts of mixed models. The general form of our models is displayed in the following table:

| Equation | Formula |
| --- | --- |
| \\((β\_0 + b\_{S,0s}) + (β\_{1} + b\_{I,1i}) \cdot \text{{condit}} + (β\_{2} + b\_{I,2i}) \cdot \text{{bandInt}} + e\_{si}\\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))` |

This model represents the distribution of a dependent variable, `dist`, as a function of the variables `condit` and `bandInt`, with random effects on individual identifiers (`id`). 

Further details on the formulation are provided in the following tables:

| Formula | Meaning |
| --- | --- |
| `(1|group)` | random group intercept |
| `(x|group)` = `(1+x|group)` | random slope of x within group with correlated intercept |
| `(0+x|group)` = `(-1+x|group)` | random slope of x within group: no variation in intercept |

For the model `e1_distBMM`, the meaning translates to:

- `(1 + bandInt|id)`: random intercept and random slope of `bandInt` within the group `id` with correlated intercept.

In our specific context, the hierarchical structure and distributional assumptions will be further illustrated using a tikz graph, representing the layers of the model and the relationships between the components. Unfortunately, I'm unable to render the tikz graphing here, but I can help you draft the LaTeX code to generate the desired graph. Let me know if that is needed.


## 30

j} &\\sim \\beta_0 + b_{0j} + \\beta_1 X_i + e_{si} \\\\ b_{0j} &\\sim \\mathcal{N}(0, \\sigma\_{b0}) \\end{aligned} \\\] | \\\[ Y\_{i\_j} \\sim \\beta_0 + \\beta_1 X_i + (b_{0j} + e_{si}) \\\] |
| Random slope of x within group with correlated intercept | `y ~ x + (1 + x \| group)` | \\\[ \\begin{aligned} Y\_{i\_j} &\\sim \\mathcal{N}(\\mu\_{i\_j}, \\sigma\_y) \\\\ \\mu\_{i\_j} &\\sim (\\beta_0 + b_{0j}) + (\\beta_1 + b_{1j}) X_i + e_{si} \\\\ \\left( \\begin{array}{c} b_{0j} \\\\ b_{1j} \\end{array} \\right) &\\sim \\mathcal{N} \\left( \\begin{array}{c} 0 \\\\ 0 \\end{array}, \\begin{array}{cc} \\sigma^2\_{b0} & \\rho\_{b0,b1} \\sigma\_{b0} \\sigma\_{b1} \\\\ \\rho\_{b0,b1} \\sigma\_{b0} \\sigma\_{b1} & \\sigma^2\_{b1} \\end{array} \\right) \\end{aligned} \\\] | \\\[ Y\_{i\_j} \\sim \\beta_0 + \\beta_1 X_i + (b_{0j} + b_{1j} X_i + e_{si}) \\\] |
| Random slope of x within group: no variation in intercept | `y ~ x + (0 + x \| group)` | \\\[ \\begin{aligned} Y\_{i\_j} &\\sim \\mathcal{N}(\\mu\_{i\_j}, \\sigma\_y) \\\\ \\mu\_{i\_j} &\\sim \\beta_0 + (\\beta_1 + b_{1j}) X_i + e_{si} \\\\ b_{1j} &\\sim \\mathcal{N}(0, \\sigma\_{b1}) \\end{aligned} \\\] | \\\[ Y\_{i\_j} \\sim \\beta_0 + \\beta_1 X_i + (b_{1j} X_i + e_{si}) \\\] |

## Model Code and Structure

Given the following model code:

```R
e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))
```

We can represent it using the table style as follows:

| equation | formula |
| --- | --- |
| \\((\\beta\_0 + b\_{I,0i}) + (\\beta\_1 + b\_{S,1s}) \\text{condit} + (\\beta\_2 + b\_{S,2s}) \\text{bandInt} + (\\beta\_3 + b\_{S,3s}) \\text{condit} \\times \\text{bandInt} + e\_{si}\\) | `∼ condit * bandInt + (1 + bandInt∣id)` |

For the hierarchical structure and distributional assumptions, the following tikz code may be used to generate a graph:

```tex
\\documentclass[tikz,border=10pt]{standalone}
\\usepackage{tikz}
\\usetikzlibrary{arrows,positioning}

\\begin{document}
\\begin{tikzpicture}[
  node distance=1cm and 1cm,
  mynode/.style={draw,ellipse,text width=2cm,align=center}
]
\\node[mynode] (level1) {Level 1: Fixed Effects};
\\node[mynode,below=of level1] (level2) {Level 2: Random Effects (Subject)};
\\node[mynode,below=of level2] (level3) {Level 3: Random Effects (Item)};
\\node[mynode,below=of level3] (level4) {Level 4: Residuals};

\\path (level1) edge[->] (level2);
\\path (level2) edge[->] (level3);
\\path (level3) edge[->] (level4);
\\end{tikzpicture}
\\end{document}
```

This code generates a hierarchical diagram illustrating the four-level structure of the model, from fixed effects to random effects at the subject and item levels, and down to the residuals, describing the distributional assumptions of the model.

## 31

Certainly. The revised description based on the provided style can be written as follows:

## Analyses Strategy

We utilize Bayesian methodology to quantify the uncertainty in parameter estimates, and to avoid convergence issues that are often found with frequentist methods of mixed models. The models' median values and 95% credible intervals are reported. Here's the tabular representation:

### Model Structure

| equation | formula |
| --- | --- |
| \\((β\_0 + b\_{I,0i}) + (β\_{1} + b\_{S,1s}) \cdot \text{bandInt} + e\_{si}\\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt\|id))` |

### Formula Interpretation

| formula | meaning |
| --- | --- |
| `(1\|id)` | random intercept within ID |
| `(1+bandInt\|id)` | random slope of bandInt within ID with correlated intercept |

### Full {brms} model

The model defined is complex and powerful, enabling us to consider individual variations across features. For instance, it considers individual-specific attributes like carpooling preference in influencing features like seating and cargo space. 

A formal definition of the model with priors for parameter estimation is given:

\\[\\begin{aligned}
&\textbf{Multinomial probability of selection of choice}_i \textbf{ in respondent}_j \\
&\dots \\
&\textbf{Priors} \\
&\dots \\
\end{aligned}\\]

### Summary

| | Formula syntax | Full \\(\\beta\\) notation | Offset notation |
| --- | --- | --- | --- |
| Random intercept | `y ~ x + (1 \| group)` | \\[ \\begin{aligned} Y\_{i\_j} &\sim \\mathcal{N}(\\mu\_{i\_j}, \\sigma\_y) \\\\ \\mu\_{i\_j} &= \\beta\_{0\_j} + \\beta\_1 X\_{i\_j} \dots

This table-based representation efficiently conveys the model's structure, connection between code, and conceptual ideas, providing an easy-to-follow description.


## 32



Certainly. Based on the desired style, I have rewritten the analysis strategy to match the alternate write-up. Here's the revised version:

## Analyses Strategy

Our models leverage Bayesian methodology to quantify uncertainty in our parameter estimates and avoid convergence issues. The representation of our models is given by tables showing connections between models, code, and conceptual ideas.

| equation | formula |
| --- | --- |
| \\(\beta_0 + \beta_1 \cdot \text{condit}_{ij} + \beta_2 \cdot \text{bandInt}_{ij} + \beta_3 \cdot \text{condit}_{ij} \cdot \text{bandInt}_{ij} + b_{0i} + b_{1i} \cdot \text{bandInt}_{ij} + \epsilon_{ij}\\) | `dist ~ condit * bandInt + (1 + bandInt | id)` |

| formula | meaning |
| --- | --- |
| `(1\|id)` | random participant intercept |
| `(1 + bandInt\|id)` | random slope of bandInt within participant with correlated intercept |

### Full Model

This model is complex but powerful. It accounts for individual-specific differences, such as the deviation from the target velocity band (dist) as a function of training condition (condit), target velocity band (bandInt), and their interaction, with random intercepts and slopes for each participant (id). The primary model is given as:

\\[ \begin{aligned}
\text{dist}_{ij} &= \beta_0 + \beta_1 \cdot \text{condit}_{ij} + \beta_2 \cdot \text{bandInt}_{ij} + \beta_3 \cdot \text{condit}_{ij} \cdot \text{bandInt}_{ij} \\
&+ b_{0i} + b_{1i} \cdot \text{bandInt}_{ij} + \epsilon_{ij}
\end{aligned} \\]

For the detailed model code:

```r
#| eval=FALSE
e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt | id))
```

See references for descriptive statistics of the raw empirical data, and the corresponding figures for visual representation of the full distributions.

### Priors

\\[
\begin{aligned}
\beta_{0 \dots 3} &\sim \mathcal{N}(0, 3) \qquad\qquad\text{Prior for model-level coefficients} \\
b_{0i} &\sim \mathcal{N}(0, 3) \qquad\qquad\text{Prior for random intercept} \\
b_{1i} &\sim \mathcal{N}(0, 3) \qquad\qquad\text{Prior for random slope}
\end{aligned}
\\]

This concise representation emphasizes the structure of the model, bridging the gap between mathematical equations, programming code, and theoretical understanding.

## 33


Certainly. Below is the modified description matching the desired style. I've included tables that demonstrate the connections between model equations, code, and conceptual ideas. Additionally, the visuals that convey the structure of the model have been integrated.

## Analyses Strategy

The primary model used in our analyses employs a Bayesian approach. This strategy allows us to quantify uncertainty in our parameter estimates and circumvent convergence issues. The model is defined in R via the brms package with the code `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))`. The general form of the model can be represented in three distinct parts: model equations, code, and conceptual ideas.

### Model Equations

The equation of the model is given by:

\[
dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + \beta_3 \cdot condit_{ij} \cdot bandInt_{ij} + b_{0i} + b_{1i} \cdot bandInt_{ij} + \epsilon_{ij}
\]

### Model Equations vs. R Formula

The following table illustrates the relationship between the model's mathematical expressions and their corresponding R formula.

| equation | formula |
| --- | --- |
| \((\beta_0 + b_{0i}) + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + \beta_3 \cdot condit_{ij} \cdot bandInt_{ij}\) | `dist ~ condit * bandInt + (1 + bandInt | id)` |

### Formula vs. Meaning

This table connects the mathematical formula with the meaning of each element.

| formula | meaning |
| --- | --- |
| `(1\|id)` | random intercept for each participant (id) |
| `(1 + bandInt\|id)` | random slope of bandInt within participant with correlated intercept |

### Visuals

For descriptive statistics of the raw empirical data, refer to @tbl-e1-test-nf-deviation, and for a visual representation of the full distributions, see @fig-e1-test-vx.

## Finally, the full {brms} model

This intricate model accounts for individual-specific differences across the various aspects of our study. The formal definition, including priors for the parameters being estimated, is as follows:

\[ \begin{aligned} 
&\textbf{Multinomial probability of selection of choice}_i \textbf{ in respondent}_j \\
\text{Choice}_{i_j} \sim& \operatorname{Categorical}(\{\mu_{1,i_j}, \mu_{2,i_j}, \mu_{3,i_j}\}) \\ 
\{...\} \\
&\beta_{0 \dots 7} \sim \mathcal{N} (0, 3) \qquad\qquad\ \[\text{Prior for choice-level coefficients}\] \\
&\gamma^{\beta_{0 \dots 7}}_0 \sim \mathcal{N} (0, 3) \qquad\qquad\ \[\text{...}\]
\end{aligned} \]

Please consult the full description for more comprehensive understanding of each part, including the covariance structure and priors. The model's complexity is in alignment with our approach to accurately describe the multifaceted relationships within our dataset.





## 34

Certainly, here's a modified version of your current description, designed to emphasize the connections between models, code, and conceptual ideas using tables and visuals.

## Analyses Strategy

Our analysis employs Bayesian mixed effects regression models, employing `brms` in R, to provide direct quantification of uncertainty in parameter estimates, and to avert convergence issues. The model predicts the absolute deviation from the target velocity band (dist) as a function of training condition (condit), target velocity band (bandInt), and their interaction, with participant-specific random intercepts and slopes.

### Model Code and Structure

The code for the model:

```r
#| eval=FALSE
e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))
```

And the model can be formally represented as:

\[
\begin{equation}
dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + \beta_3 \cdot condit_{ij} \cdot bandInt_{ij} + b_{0i} + b_{1i} \cdot bandInt_{ij} + \epsilon_{ij}
\end{equation}
\]

### Connection Between Models, Code, and Conceptual Ideas

| equation | formula | conceptual ideas |
| --- | --- | --- |
| \(\beta_0 + b_{0i}\) | `∼ (1|id)` | random intercept for each participant (id) |
| \(\beta_1 \cdot condit_{ij}\) | `∼ condit` | fixed effect of training condition (condit) |
| \(\beta_2 \cdot bandInt_{ij} + b_{1i} \cdot bandInt_{ij}\) | `∼ bandInt + (1 + bandInt|id)` | fixed effect of target velocity band and random slope within participant (id) |
| \(\beta_3 \cdot condit_{ij} \cdot bandInt_{ij}\) | `∼ condit * bandInt` | interaction between training condition and target velocity band |

See @tbl-e1-test-nf-deviation for descriptive statistics of the raw empirical data, and @fig-e1-test-vx for a visual representation of the full distributions.

### Finally, the full {brms} model

The complexity of this model is aimed at accommodating individual-specific differences across features, such as how individual carpools might influence preferences for various aspects.

Priors for the parameters to be estimated are defined as follows:

\[
\begin{aligned}
\beta_{0 \dots 7} &\sim \mathcal{N} (0, 3) \quad \text{[Prior for choice-level coefficients]} \\
\gamma^{\beta_{0 \dots 7}}_0 &\sim \mathcal{N} (0, 3) \quad \text{[...]}
\end{aligned}
\]

Please refer to the equations above to see the complete structure, including the Multivariate Normal distribution that accommodates respondent-specific slopes and prior specifications.

---

This revised section emphasizes the connections between the model, code, and conceptual ideas, featuring tables and visual representations. The format encourages clarity and alignment with the desired style of description.


## 35

Certainly. Based on the desired style, I have rewritten the analysis strategy to match the alternate write-up. Here's the revised version:

## Analyses Strategy

Our models leverage Bayesian methodology to quantify uncertainty in our parameter estimates and avoid convergence issues. The representation of our models is given by tables showing connections between models, code, and conceptual ideas.

| equation | formula |
| --- | --- |
| \\(\beta_0 + \beta_1 \cdot \text{condit}_{ij} + \beta_2 \cdot \text{bandInt}_{ij} + \beta_3 \cdot \text{condit}_{ij} \cdot \text{bandInt}_{ij} + b_{0i} + b_{1i} \cdot \text{bandInt}_{ij} + \epsilon_{ij}\\) | `dist ~ condit * bandInt + (1 + bandInt | id)` |

| formula | meaning |
| --- | --- |
| `(1\|id)` | random participant intercept |
| `(1 + bandInt\|id)` | random slope of bandInt within participant with correlated intercept |

### Full Model

This model is complex but powerful. It accounts for individual-specific differences, such as the deviation from the target velocity band (dist) as a function of training condition (condit), target velocity band (bandInt), and their interaction, with random intercepts and slopes for each participant (id). The primary model is given as:

\\[ \begin{aligned}
\text{dist}_{ij} &= \beta_0 + \beta_1 \cdot \text{condit}_{ij} + \beta_2 \cdot \text{bandInt}_{ij} + \beta_3 \cdot \text{condit}_{ij} \cdot \text{bandInt}_{ij} \\
&+ b_{0i} + b_{1i} \cdot \text{bandInt}_{ij} + \epsilon_{ij}
\end{aligned} \\]

For the detailed model code:

```r
#| eval=FALSE
e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt | id))
```

See references for descriptive statistics of the raw empirical data, and the corresponding figures for visual representation of the full distributions.

### Priors

\\[
\begin{aligned}
\beta_{0 \dots 3} &\sim \mathcal{N}(0, 3) \qquad\qquad\text{Prior for model-level coefficients} \\
b_{0i} &\sim \mathcal{N}(0, 3) \qquad\qquad\text{Prior for random intercept} \\
b_{1i} &\sim \mathcal{N}(0, 3) \qquad\qquad\text{Prior for random slope}
\end{aligned}
\\]

This concise representation emphasizes the structure of the model, bridging the gap between mathematical equations, programming code, and theoretical understanding.


## 36

Certainly. Below is the revised description that emphasizes connections between models, code, and conceptual ideas, aligning with the desired style.

## Analyses Strategy

Our analytical approach leverages Bayesian methods, offering direct quantification of the uncertainty in our parameter estimates. The connection between models, code, and concepts can be represented through the following tables:

### Equations and Their Corresponding Formulas

| equation                                                                                   | formula                                                     |
|---------------------------------------------------------------------------------------------|-------------------------------------------------------------|
| \\(dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij}\)          | n/a (Not a mixed-effects model)                             |
| \\(dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + b_{0i}\) | `dist ~ condit * bandInt + (1 | id)`                        |
| \\(dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + b_{1i} \cdot bandInt_{ij} + \epsilon_{ij}\) | `dist ~ condit * bandInt + (1 + bandInt | id)` |

### Formulas and Their Meanings

| formula                              | meaning                                                      |
|--------------------------------------|--------------------------------------------------------------|
| `(1\|id)`                            | random intercept for each participant (id)                   |
| `(condit * bandInt\|id)`             | random slope of training condition and target velocity band within participant with correlated intercept |

## The Full {brms} Model

This intricate model allows us to discern individual-specific differences related to the deviation from target velocity band (`dist`), considering factors such as training condition (`condit`) and target velocity band (`bandInt`). The model is implemented using the {brms} package in R.

Model code: `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))`

Formal equation:

\[
\begin{equation}
dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + \beta_3 \cdot condit_{ij} \cdot bandInt_{ij} + b_{0i} + b_{1i} \cdot bandInt_{ij} + \epsilon_{ij}
\end{equation}
\]




## 37


Certainly, the modified version of the description adhering to the desired style and with an emphasis on tables is as follows:

## Analyses Strategy

We employ Bayesian methods, allowing us to quantify uncertainty in parameter estimates and avoid convergence issues found in frequentist counterparts. For each model, the median values of the posterior distribution, along with 95% credible intervals, are reported. The structure of our model can be seen in the following tables and equations:

### Model Equations and Coefficients

| equation | formula |
| --- | --- |
| \\(dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + \beta_3 \cdot condit_{ij} \cdot bandInt_{ij} + b_{0i} + b_{1i} \cdot bandInt_{ij} + \epsilon_{ij}\\) | `dist ~ condit * bandInt + (1 + bandInt | id)` |

### Coefficient Interpretation

| formula | meaning |
| --- | --- |
| `(1\|id)` | random intercept for each participant |
| `(1 + bandInt\|id)` | random slope of `bandInt` within participant with correlated intercept |

The model code implemented via brms in R is given by:

```r
#| eval=FALSE
e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))
```

For a detailed visual representation of the data distributions, refer to the figures `@fig-e1-test-vx`, and see `@tbl-e1-test-nf-deviation` for descriptive statistics of the raw empirical data.

This Bayesian mixed-effects model predicts the absolute deviation from the target velocity band (dist) as a function of training condition (condit), target velocity band (bandInt), and their interaction, with random intercepts and slopes for each participant (id). It allows us to assess differences in accuracy between groups, incorporating individual-specific differences as required.

The full equation for the model is as follows:

\begin{equation}
dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + \beta_3 \cdot condit_{ij} \cdot bandInt_{ij} + b_{0i} + b_{1i} \cdot bandInt_{ij} + \epsilon_{ij}
\end{equation}

## 38


Certainly, here's the revised description in the desired style:

## Analyses Strategy

The analysis leverages Bayesian mixed effects regression models for directly quantifying the uncertainty in parameter estimates and for evading convergence issues, implemented via brms in R. The model predicts the absolute deviation from the target velocity band (dist) as a function of training condition (condit), target velocity band (vb), and their interaction, with random intercepts and slopes for each participant (id). The formula, equation, and code for the model are provided below:

| equation | formula | code |
| --- | --- | --- |
| \\(dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + \beta_3 \cdot condit_{ij} \cdot bandInt_{ij} + b_{0i} + b_{1i} \cdot bandInt_{ij} + \epsilon_{ij}\) | \\((\beta_0 + b_{I,0i}) + (\beta_1 + b_{S,1s})X\_i + e_{si}\\) | `dist ~ condit * bandInt + (1 + bandInt|id)` |

| formula | meaning |
| --- | --- |
| `(1\|id)` | random intercept for each participant |
| `(bandInt\|id)` | random slope of bandInt within participant with correlated intercept |

## Model code

```r
#| eval=FALSE
e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))
```

For the full distributions and descriptive statistics of the raw empirical data, refer to `@tbl-e1-test-nf-deviation` and `@fig-e1-test-vx` respectively. The median values of the posterior distribution and 95% credible intervals are reported for each model.

The visual representation of the model is available in `@fig-e1-test-vx`.

This complex model allows for individual-specific differences to be accounted for, such as variations in preference for specific features. Priors have been defined for the parameters estimated, aligning with the desired assumptions.



## 39


Certainly. Below is a revision of the original description to match the desired style, incorporating tables and reorganizing the information.

## Analyses Strategy

We employed Bayesian mixed-effects regression models implemented via the `brms` package in R to predict the absolute deviation from the target velocity band (dist) as a function of training condition, target velocity band, and their interaction. These models allow us to directly quantify uncertainty in parameter estimates, bypassing convergence issues found in frequentist analogues. For each model, we report median values of the posterior distribution and 95% credible intervals.

| **Equation** | **Model Code** | **Meaning** |
| --- | --- | --- |
| \( dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + \beta_3 \cdot condit_{ij} \cdot bandInt_{ij} + b_{0i} + b_{1i} \cdot bandInt_{ij} + \epsilon_{ij} \) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))` | This model predicts the absolute deviation from the target velocity band as a function of training condition and target velocity band. |

| **Formula** | **Meaning** |
| --- | --- |
| `(1|id)` | Random intercept for each participant (id) |
| `(1 + bandInt|id)` | Random slope of `bandInt` within participant (id) with correlated intercept |

See @tbl-e1-test-nf-deviation for descriptive statistics of the raw empirical data, and @fig-e1-test-vx for a visual representation of the full distributions.

### Finally, the full {brms} model

This complex and powerful model accounts for individual-specific differences across the features of interest. 

\[ \begin{aligned}
&\textbf{Equation:} \\
&dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + \beta_3 \cdot condit_{ij} \cdot bandInt_{ij} + b_{0i} + b_{1i} \cdot bandInt_{ij} + \epsilon_{ij}
\end{aligned} \]

**Priors for the parameters:**

- \(\beta_{0 \dots 7} \sim \mathcal{N} (0, 3)\) (Prior for choice-level coefficients)
- \(\gamma^{\beta_{0 \dots 7}}_0 \sim \mathcal{N} (0, 3)\) (Additional details as needed)

Here, \(\beta_0, \beta_1, \beta_2\), etc. represent fixed effects, while \(b_{0i}, b_{1i}\) symbolize random effects. The model's structure permits us to understand how individual characteristics like carpooling might influence preferences for other features. Further details on individual-specific influences are to be provided based on the data analysis.

This revised version aligns the description with the desired style, including tables and visuals to explain the structure of the model.

## 40

Certainly. Below is a revised description of the analysis strategy that emphasizes tables to show the connections between models, code, and conceptual ideas.

## Analyses Strategy

In the following analyses, Bayesian mixed effects regression models were implemented through brms in R. The main objective was to predict the absolute deviation from the target velocity band (dist) as a function of training condition (condit), target velocity band (bandInt), and their interaction, including random intercepts and slopes for each participant (id). The choice of Bayesian methods permitted direct quantification of uncertainty in the parameter estimates and avoided common convergence issues.

### Equation and Model Code

| Equation                                                                                           | Model Code                                     | Description                                                                                 |
|----------------------------------------------------------------------------------------------------|------------------------------------------------|---------------------------------------------------------------------------------------------|
| \\(dist_{ij} = \beta_0 + \beta_1 \cdot condit_{ij} + \beta_2 \cdot bandInt_{ij} + \beta_3 \cdot condit_{ij} \cdot bandInt_{ij} + b_{0i} + b_{1i} \cdot bandInt_{ij} + \epsilon_{ij}\\) | `e1_distBMM <- brm(dist ~ condit * bandInt + (1 + bandInt|id))` | Prediction of absolute deviation from target velocity band (dist)                           |
 
### Formula and Meaning

| Formula                           | Meaning                                                                                       |
|-----------------------------------|-----------------------------------------------------------------------------------------------|
| `(1\|id)`                         | random intercept for participant (id)                                                         |
| `(1 + bandInt\|id)`               | random slope of target velocity band (bandInt) within participant (id), with correlated intercept |

### Visual Representation



### Full {brms} Model Description

This complex model encompasses various features, enabling us to account for individual-specific differences. The following equation illustrates the definition of the model:

\\\ \\begin{aligned} &\\ \ldots \\ \\\\\[10pt\] &\\ \\textbf{Priors} \\\\ \\beta\_{0 \\dots 7} \\sim&\\ \\mathcal{N} (0, 3) \\qquad\\qquad\\ \[\\text{Prior for choice-level coefficients}\] \\\\ \\gamma^{\\beta\_{0 \\dots 7}}\_0 \\sim&\\ \\mathcal{N} (0, 3) \\qquad\\qquad\\ \\\text...

The model's structure captures detailed information about the connection between different factors, leading to an enhanced understanding of the empirical patterns.

### Conclusion

The utilization of Bayesian mixed-effects models has provided a robust framework for our analysis, where the model structure, coefficients, and relationships are well-represented through the use of tabular and visual depictions.



## 41



## 42





## 43

## 44


$$
\begin{aligned}
  \operatorname{vx}_{i}  &\sim N \left(\alpha_{j[i]} + \beta_{1j[i]}(\operatorname{bandInt}), \sigma^2 \right) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &\alpha_{j} \\
      &\beta_{1j}
    \end{aligned}
  \end{array}
\right)
  &\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &\gamma_{0}^{\alpha} + \gamma_{1}^{\alpha}(\operatorname{condit}_{\operatorname{Varied}}) \\
      &\mu_{\beta_{1j}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     \sigma^2_{\alpha_{j}} & \rho_{\alpha_{j}\beta_{1j}} \\ 
     \rho_{\beta_{1j}\alpha_{j}} & \sigma^2_{\beta_{1j}}
  \end{array}
\right)
 \right)
    \text{, for id j = 1,} \dots \text{,J}
\end{aligned}
$$

<!-- `#r cat(extract_eq(m1, use_coefs = TRUE))` -->

$$
\begin{aligned}
  \operatorname{\widehat{vx}}_{i}  &\sim N \left(480.37_{\alpha_{j[i]}} + 0.63_{\beta_{1j[i]}}(\operatorname{bandInt}), \sigma^2 \right) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &\alpha_{j} \\
      &\beta_{1j}
    \end{aligned}
  \end{array}
\right)
  &\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &56.83_{\gamma_{1}^{\alpha}}(\operatorname{condit}_{\operatorname{Varied}}) \\
      &0
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{cc}
     351.8 & -0.8 \\ 
     -0.8 & 0.38
  \end{array}
\right)
 \right)
    \text{, for id j = 1,} \dots \text{,J}
\end{aligned}
$$


$$
\begin{aligned}
  y_{ij}  &\sim N \left(\alpha_{j[i]} + \beta_{1j[i]}(\operatorname{condit}_{ij}) + \beta_{2j[i]}(\operatorname{bandInt}_{ij}), \sigma^2 \right) \\    
\left(
  \begin{array}{c} 
    \begin{aligned}
      &\alpha_{j} \\
      &\beta_{1j} \\
      &\beta_{2j}
    \end{aligned}
  \end{array}
\right)
  &\sim N \left(
\left(
  \begin{array}{c} 
    \begin{aligned}
      &\gamma_{0}^{\alpha} \\
      &\gamma_{0}^{\beta_{1}} + \gamma_{1}^{\beta_{1}}(\operatorname{condit}_{\operatorname{Varied}}) \\
      &\gamma_{0}^{\beta_{2}}
    \end{aligned}
  \end{array}
\right)
, 
\left(
  \begin{array}{ccc}
     \sigma^2_{\alpha_{j}} & 0 & 0 \\ 
     0 & \sigma^2_{\beta_{1j}} & 0 \\
     0 & 0 & \sigma^2_{\beta_{2j}}
  \end{array}
\right)
 \right)
    \text{, for id j = 1,} \dots \text{,J}
\end{aligned}
$$




```{r}
#| eval: false

m1_bayes <- brm(vx ~ 1 + bandInt + condit + (1 + bandInt | id), 
data = test, family = gaussian(), file="band_gauss_vx")

m1_bayesb <- brm(vxb ~ 1 + bandInt + condit + (1 + bandInt | id), 
data = test, family = gaussian(), file="band_gauss_vxb")

m1_bayes0 <- brm(vx ~ 0 + bandInt + condit + (0 + bandInt | id), 
data = test, family = gaussian(), file="band0_gauss_vx")

m1_bayes0b <- brm(vxb ~ 0 + bandInt + condit + (0 + bandInt | id), 
data = test, family = gaussian(), file="band0_gauss_vxb")

summary(m1_bayes)

```

```{r}
#| eval: false
# Calculate the standard deviation of the estimates for each level of id
m_all %>%
  summarise(across(starts_with("group_"), sd, na.rm = TRUE))

# Calculate the correlation between the estimates for each level of id
m_all %>%
  group_by(id) %>%
  summarise(correlation = cor(`bandInt`, `Intercept`, use = "pairwise.complete.obs"))


m_all |> filter(id==10)

```

```{r}
#| eval: false

options(mc.cores = 8,  # Use 4 cores
        brms.backend = "cmdstanr")

model_fixed <- brm(
  bf(vxMean ~ bandInt + (1 +bandInt | id)),
  data = testAvg,
  control = list(adapt_delta = 0.95),
  chains = 4, seed = 1234
)



fixef(model_fixed)

mm_Mean_b <- coef(model_fixed)$id |> as.tibble(rownames="id") |> select(id,starts_with("Estimate"))
head(mm_Mean_b)


X <- cbind(testAvg[,1:8], fitted(model_fixed)[,-2]) %>% as_tibble()


ggplot(X[1:90,],aes(y=Estimate,x=vb,group=id))+geom_point(aes(y=vxMean),shape=1)+
  geom_line(aes(y=Q2.5),lty=2)+
  geom_line(aes(y=Q97.5),lty=2)+
  geom_smooth(aes(y=vxMean),method = "lm", fill = "dodgerblue", level = .95)+
  facet_wrap(~id)

conditional_effects(model_fixed)
#conditional_effects(model_fixed,conditions=distinct(testAvg,id))


predict(model_fixed,data.frame(id=1,bandInt=800))



epred_draws(model_fixed,newdata=expand_grid(bandInt=unique(e1$bandInt),id=factor(e1$id,levels=unique(e1$id))),ndraws = 1)

```

```{r}
#| eval: false

log_m1 <- brm(
  bf(vx ~ bandInt + (1 +bandInt | id)),
  data = test,
  family=shifted_lognormal(),
  control = list(adapt_delta = 0.95),
  chains = 2, seed = 1234
)

summary(log_m1)


skew_m1 <- brm(
  bf(vxMean ~ bandInt + (1 +bandInt | id)),
  data = testAvg,
  family=skew_normal(),
  control = list(adapt_delta = 0.95),
  chains = 2, seed = 1234
)

summary(skew_m1)



```

```{r}
#| eval: false
library(brms)

bmerFit <- function(mform,df) {
  m <- brm(mform, data = df, control = list(adapt_delta = 0.95), chains = 1, seed = 1234)
  fe <- fixef(m)
  dfm <- coef(m)$id %>% as.tibble(rownames="id") %>% select(id, starts_with("Estimate"))
  
  for (effect in names(fe)) {
    dfm <- dfm %>% mutate(!!str_c("group_", effect) := fe[effect])
  }
  dfm
}

# Input formulas and corresponding dataframes
formulas <- c("vx ~ 1 + bandInt + (1 + bandInt | id)", 
              "vxMean ~ 1 + bandInt + (1 + bandInt | id)", 
              "vxMed ~ 1 + bandInt + (1 + bandInt | id)")
dfs <- list(test, testAvg, testAvg)

# Run bmerFit function over all combinations of formulas and dataframes
m_all_bayes <- map2_dfr(formulas, dfs, ~ bmerFit(.x, .y)) %>%
  mutate(mformula = rep(formulas, each = length(unique(test$id))), 
         dframe = rep(c('test', 'testAvg', 'testAvg'), each=length(unique(test$id))))

m_all_bayes(m_all)
m_all_bayes |> filter(id==10)

```

```{r}


```
